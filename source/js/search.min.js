function search() {
    // 防抖函数，避免频繁触发搜索
    function debounce(func, delay = 400) {
        let timer = -1;
        return (...args) => {
            clearTimeout(timer);
            timer = setTimeout(() => {
                func(...args);
            }, delay);
        };
    }

    // 搜索逻辑
    function performSearch() {
        resultContainer.innerHTML = ""; // 清空结果
        const query = searchInput.value.trim().toLowerCase();

        if (query === "") return; // 如果输入为空，直接返回

        const fragment = document.createDocumentFragment();
        entries.forEach((entry) => {
            const title = entry.querySelector("title").textContent.toLowerCase();
            const content = entry.querySelector("content").textContent.toLowerCase();
            const url = entry.querySelector("url").textContent;

            // 检查关键词是否匹配 title 或 content
            if (title.includes(query) || content.includes(query)) {
                const link = document.createElement("a");
                link.href = url;
                link.textContent = entry.querySelector("title").textContent;
                link.className = "search-result-item";

                const listItem = document.createElement("li");
                listItem.appendChild(link);
                fragment.appendChild(listItem);
            }
        });

        resultContainer.appendChild(fragment);
    }

    // 获取搜索数据
    let entries = [];
    fetch("/search.xml")
        .then((response) => response.text())
        .then((xmlText) => {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, "application/xml");
            entries = Array.from(xmlDoc.querySelectorAll("entry"));
        })
        .catch(console.error);

    // 获取 DOM 元素
    const searchInput = document.getElementById("search-text");
    const resultContainer = document.getElementById("searchResult");

    // 绑定输入事件
    const debouncedSearch = debounce(performSearch);
    searchInput.addEventListener("input", debouncedSearch);
}

// 等页面加载完成后初始化搜索功能
window.addEventListener("load", search);